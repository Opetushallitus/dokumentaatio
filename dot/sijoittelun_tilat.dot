digraph g {
  rankdir=LR;
  node [shape=doublecircle];

  Laskenta -> HYLATTY [label="HYLATTY\nlaskennassa" style=dotted];
  Laskenta -> HYVAKSYTTY [label="HYVAKSYTTAVISSA\nlaskennassa" style=dotted];
  Laskenta -> VARALLA [label="HYVAKSYTTAVISSA\nmutta ei mahdu\naloituspaikoille" style=dotted];
  VARALLA -> VARASIJALTA_HYVAKSYTTY [label="Vapautunut\naloituspaikka\ntarjotaan hakijalle"];
  VARALLA -> PERUNUT [xlabel="Aloituspaikkaa ei\nvapautunut määräaikaan\nmennessä"];
  PERUUNTUNUT [label="PERUUNTUNUT\n(toisen paikan\nvastaanotto)"];
  PERUNUT [label="PERUNUT\n(hakija\nperuu paikan\nvastaanotossa)"];

  Laskenta -> HARKINNANVARAISESTI_HYVAKSYTTY [label="Virkailija pakottaa\nhyväksymisen" style=dotted];

  HARKINNANVARAISESTI_HYVAKSYTTY, HYVAKSYTTY, VARASIJALTA_HYVAKSYTTY -> PERUUTETTU;

  subgraph cluster_vastaanotto {
    label="Vastaanoton\nmahdollinen seuraus";
    color=gray;
    rank=same;
    PERUUNTUNUT, PERUNUT;
  }

  subgraph cluster_hyvaksytty {
    label="Vastaanotettavissa\njulkaisun jälkeen";
    color=gray;
    rank=same;
    HYVAKSYTTY
    HARKINNANVARAISESTI_HYVAKSYTTY [label="HARKINNAN\nVARAISESTI\n_HYVAKSYTTY"];
    VARASIJALTA_HYVAKSYTTY [label="VARASIJALTA\n_HYVAKSYTTY"];
  }

  VARALLA [shape=circle];
  Laskenta, Julkaisu, Vastaanotto [shape=hexagon];

  { rank=same; Julkaisu, Vastaanotto }
  { rank=same; HYLATTY; HYVAKSYTTY; }
  { rank=same; PERUUTETTU [label="PERUUTETTU\n(oppilaitos\nhylkää\nhyväksymisen)"]; PERUNUT; }

  HARKINNANVARAISESTI_HYVAKSYTTY, HYVAKSYTTY, VARASIJALTA_HYVAKSYTTY -> Julkaisu -> Vastaanotto -> PERUNUT, PERUUNTUNUT [style=dotted];
}
