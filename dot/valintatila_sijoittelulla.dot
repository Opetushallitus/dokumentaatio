digraph g {
  rankdir=LR;
  node [shape=doublecircle];

  Hakutoive -> HYLATTY [label="Virkailija hylkää"];
  Hakutoive -> HYVAKSYTTY [label="Sijoittelu hyväksyy"];
  Hakutoive -> VARALLA [label="Hyväksytty\nmutta ei mahdu\nvarsinaiseen jonoon"];
  VARALLA -> VARASIJALTA_HYVAKSYTTY [label="Vapautunut paikka\ntarjotaan hakijalle"];
  VARALLA -> PERUNUT [xlabel="Paikkaa ei vapautunut\nmääräaikaan mennessä"];
  PERUUNTUNUT [label="PERUUNTUNUT\n(toisen paikan\nvastaanotto)"];
  PERUNUT [label="PERUNUT\n(hakija\nperuu paikan\nvastaanotossa)"];

  Hakutoive -> HARKINNANVARAISESTI_HYVAKSYTTY [label="Virkailija pakottaa\nhyväksymisen"];

  HARKINNANVARAISESTI_HYVAKSYTTY, HYVAKSYTTY, VARASIJALTA_HYVAKSYTTY -> PERUUTETTU;

  {
    rank=same;
    HYLATTY;
    HYVAKSYTTY;
  }
  {
    rank=same;
    PERUUTETTU [label="PERUUTETTU\n(oppilaitos\nhylkää\nhyväksymisen)"];
    PERUNUT;
  }

  subgraph cluster_vastaanotto {
    label="Vastaanoton\nmahdollinen seuraus";
    color=gray;
    rank=same;
    PERUUNTUNUT, PERUNUT;
  }

  subgraph cluster_hyvaksytty {
    label="Vastaanotettavissa\njulkaisun jälkeen";
    color=gray;
    rank=same;
    HYVAKSYTTY
    HARKINNANVARAISESTI_HYVAKSYTTY [label="HARKINNAN\nVARAISESTI\n_HYVAKSYTTY"];
    VARASIJALTA_HYVAKSYTTY [label="VARASIJALTA\n_HYVAKSYTTY"];
  }

  VARALLA [shape=circle];
  Vastaanotto [shape=hexagon];
  HARKINNANVARAISESTI_HYVAKSYTTY, HYVAKSYTTY, VARASIJALTA_HYVAKSYTTY -> Vastaanotto -> PERUNUT, PERUUNTUNUT [style=dotted];
}
