<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="common.css"/>
    <script src="common_ui.js"></script>
    <script src="util.js"></script>
</head>
<body>

[<a href="/">menu</a>]

<script type="text/javascript">

    var data = {}

    ajaxJson('GET', "/rest/server_state", initTable)

    function initTable(json) {
        data.originalJSON = json
        data.projectInfoMap = util.combineSourcesToProjectInfoMap(json.sources)
        data.summary = util.collectProjectInfoSummary(data.projectInfoMap)
        var scanInfo = json.scanInfo;

        // errors

        var errors = scanInfo.errors;
        if(errors.length > 0 ) {
            addNode(document.body, "h1", "Errors " + errors.length)
            createSingleTextColumnTable(addNode(document.body, "table", {class: "dataTable"}), errors);
        }

        // projects without definition

        var noDefinition = data.summary.items.filter(function (name) {
            return !(name in data.projectInfoMap)
        })

        if(noDefinition.length > 0 ) {
            addNode(document.body, "h1", "Projects with no definition " + noDefinition.length + "/" + Object.keys(data.projectInfoMap).length)
            redrawFilteredInfoTable(noDefinition, addNode(document.body, "table", {class: "dataTable"}), null, function (row, rowTr) {
                addNode(addNode(rowTr, "td"), "a", {
                    href: "project.html#" + row,
                    text: row
                })
            })
        }

        addNode(document.body, "h1", "Scanned files " + scanInfo.files.length)
        createSingleTextColumnTable(addNode(document.body, "table", {class: "dataTable"}), scanInfo.files)


    }
</script>


</body>
</html>